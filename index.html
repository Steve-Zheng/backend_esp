<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>LED</title>
</head>
<body onload="javascript:init()">
<h1>Remote Control Demo</h1>
<div id="ledStatus"><b>LED</b></div>
<button id="ledOn" type="button" onclick="buttonClick(this);">On</button>
<button id="ledOff" type="button" onclick="buttonClick(this);">Off</button>
<script>
    let webSocket;

    function init() {
        webSocket = new WebSocket("wss://"+window.location.hostname);
        webSocket.onopen = function(evt) { console.log('websocket open'); };
        webSocket.onclose = function(evt) {
            console.log('websocket closed!');
            while(webSocket.readyState === WebSocket.CLOSED){
                setTimeout(function (){webSocket.connect();},2000);
            }
        };
        webSocket.onerror = function(evt) { console.log(evt); };
        webSocket.onmessage = function(evt) {
            console.log(evt);
            let e = document.getElementById('ledStatus');
            if (evt.data === 'ledOn') {
                e.style.color = 'cyan';
            }
            else if (evt.data === 'ledOff') {
                e.style.color = 'black';
            }
            else {
                console.log('unknown event');
            }
        };
    }

    async function buttonClick(e) {
        await webSock.send(e.id);
        console.log(e.id);
    }

</script>
</body>
</html>